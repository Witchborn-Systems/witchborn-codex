import argparse
import json
from cxresolve.resolver import CodexResolver

def main():
    parser = argparse.ArgumentParser(description="Witchborn Codex Authority Lookup")
    parser.add_argument("uri", help="The AI identity (e.g., acme@webai)")
    parser.add_argument("--raw", "-r", action="store_true", help="Show raw records")
    args = parser.parse_args()

    resolver = CodexResolver()

    try:
        if args.raw:
            # Full trace for custom/TXT data
            data = resolver.get_full_context(args.uri)
        else:
            # The Spec-Perfect Squish for AI agents
            data = resolver.get_mcp(args.uri)

        print(json.dumps(data, indent=2))
    except Exception as e:
        print(f"// RESOLUTION_FAILED: {e}")

if __name__ == "__main__":
    main()